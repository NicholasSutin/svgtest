<!DOCTYPE html>
<html>
<body>
<h3>Pixel-by-Pixel PNG â†’ SVG (Custom Alpha Threshold)</h3>

<input type="file" id="input" accept="image/png" /><br><br>
<label>Alpha Threshold (0.01 - 0.99): <input type="number" id="alpha" min="0.01" max="0.99" step="0.01" value="0.5"></label>

<script>
document.getElementById('input').addEventListener('change', async (e) => {
  const file = e.target.files[0];
  if (!file) return;

  const alphaThresholdInput = parseFloat(document.getElementById('alpha').value);
  const alphaThreshold = Math.min(Math.max(alphaThresholdInput, 0.01), 0.99) * 255;

  const img = new Image();
  img.src = URL.createObjectURL(file);
  await img.decode();

  const canvas = document.createElement("canvas");
  canvas.width = img.width;
  canvas.height = img.height;
  const ctx = canvas.getContext("2d");
  ctx.drawImage(img, 0, 0);

  const imgData = ctx.getImageData(0, 0, img.width, img.height).data;
  const svgPixels = [];

  for (let y = 0; y < img.height; y++) {
    for (let x = 0; x < img.width; x++) {
      const i = (y * img.width + x) * 4;
      const alpha = imgData[i + 3];
      if (alpha >= alphaThreshold) {
        svgPixels.push(`<rect x="${x}" y="${y}" width="1" height="1" />`);
      }
    }
  }

  const svgContent = `
<svg xmlns="http://www.w3.org/2000/svg" 
     viewBox="0 0 ${img.width} ${img.height}" 
     shape-rendering="crispEdges" fill="black">
  ${svgPixels.join("\n")}
</svg>
  `;

  const blob = new Blob([svgContent], { type: "image/svg+xml" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "pixel_mask.svg";
  a.click();
  URL.revokeObjectURL(url);
});
</script>
</body>
</html>
